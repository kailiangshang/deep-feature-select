# DeepFS 实验计划

## 一、实验概述

本实验计划旨在系统性地评估不同深度特征选择算法的性能表现。实验分为两大部分：

1. **对比实验**：比较三类算法在不同超参数设置下的表现
2. **消融实验**：深入分析所提算法（IPCAE + GumbelSoftmaxGate）各组件的影响

### 评估指标

| 指标 | 描述 | 计算方式 |
|-----|------|---------|
| **任务性能** | 下游任务的预测性能 | 分类: Accuracy/AUC; 回归: MSE/R² |
| **稀疏性** | 实际使用的特征数量 | 最终选择的特征数 / 总特征数 |
| **参数量** | 模型可训练参数数量 | `sum(p.numel() for p in model.parameters())` |
| **结果稳定性** | 多次运行的方差 | 5次运行的标准差/均值 |

---

## 二、对比实验

### 2.1 算法类型1：纯门控算法 (Gate-Only)

仅使用门控模块进行特征选择，不涉及编码器降维。

#### 算法列表

| 编号 | 算法名称 | 门控类型 | 论文来源 |
|-----|---------|---------|---------|
| G1 | StochasticGate | 随机门控 | STG, ICML 2020 |
| G2 | GumbelSigmoidGate | Gumbel-Sigmoid门控 | Gumbel-Softmax, 2016 |
| G3 | GumbelSoftmaxGate | Gumbel-Softmax门控 | Gumbel-Softmax, 2016 |
| G4 | HardConcreteGate | 硬混凝土门控 | L0 Regularization, ICLR 2018 |

#### 超参数设置

| 超参数 | 搜索范围 | 说明 |
|-------|---------|------|
| **稀疏系数权重 (λ)** | [0.001, 0.01, 0.1, 1, 10, 100] | **主要搜索参数** |
| input_dim | 数据集特征数 | 固定 |
| sigma (G1) | 0.5 | 固定 |
| initial_temperature | 10.0 | 固定 |
| final_temperature | 0.01 | 固定 |
| total_epochs | 100 | 固定 |
| embedding_dim (G3) | 16 | 固定 |
| temperature (G4) | 0.5 | 固定 |

#### 实验矩阵

| 实验 | 算法 | λ = 0.001 | λ = 0.01 | λ = 0.1 | λ = 1 | λ = 10 | λ = 100 |
|-----|-----|----------|---------|--------|------|-------|--------|
| G1-1 ~ G1-6 | StochasticGate | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| G2-1 ~ G2-6 | GumbelSigmoidGate | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| G3-1 ~ G3-6 | GumbelSoftmaxGate | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| G4-1 ~ G4-6 | HardConcreteGate | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |

**总计**: 4 × 6 = 24 组实验

---

### 2.2 算法类型2：纯编码算法 (Encoder-Only)

仅使用编码器模块进行特征选择，通过Gumbel-Softmax直接选择k个特征。

#### 算法列表

| 编号 | 算法名称 | 编码器类型 | 论文来源 |
|-----|---------|-----------|---------|
| E1 | ConcreteEncoder | 混凝土编码器 | CAE, ICML 2019 |
| E2 | IndirectConcreteEncoder | 间接混凝土编码器 | 基于CAE改进 |

#### 超参数设置

| 超参数 | 搜索范围 | 说明 |
|-------|---------|------|
| **特征数 k** | [1, 2, 3, ..., 50] (完整网格) | **主要搜索参数** |
| input_dim | 数据集特征数 | 固定 |
| initial_temperature | 10.0 | 固定 |
| final_temperature | 0.01 | 固定 |
| total_epochs | 100 | 固定 |
| embedding_dim (E2) | 32 | 固定 |

#### 实验矩阵

| 实验 | 算法 | k=1 | k=2 | k=3 | ... | k=48 | k=49 | k=50 |
|-----|-----|-----|-----|-----|-----|------|------|------|
| E1-1 ~ E1-50 | ConcreteEncoder | ✓ | ✓ | ✓ | ... | ✓ | ✓ | ✓ |
| E2-1 ~ E2-50 | IndirectConcreteEncoder | ✓ | ✓ | ✓ | ... | ✓ | ✓ | ✓ |

**总计**: 2 × 50 = 100 组实验

---

### 2.3 算法类型3：门控+编码算法 (Gate + Encoder)

组合门控和编码器，编码器选择k_max个候选特征，门控从中筛选实际使用的特征。

#### 算法列表

| 编号 | 算法名称 | 门控类型 | 编码器类型 |
|-----|---------|---------|-----------|
| GE1 | StochasticGate + ConcreteEncoder | 随机门控 | 混凝土编码器 |
| GE2 | StochasticGate + IndirectConcreteEncoder | 随机门控 | 间接混凝土编码器 |
| GE3 | GumbelSigmoidGate + ConcreteEncoder | Gumbel-Sigmoid门控 | 混凝土编码器 |
| GE4 | GumbelSigmoidGate + IndirectConcreteEncoder | Gumbel-Sigmoid门控 | 间接混凝土编码器 |
| GE5 | GumbelSoftmaxGate + ConcreteEncoder | Gumbel-Softmax门控 | 混凝土编码器 |
| GE6 | GumbelSoftmaxGate + IndirectConcreteEncoder | Gumbel-Softmax门控 | 间接混凝土编码器 |
| GE7 | HardConcreteGate + ConcreteEncoder | 硬混凝土门控 | 混凝土编码器 |
| GE8 | HardConcreteGate + IndirectConcreteEncoder | 硬混凝土门控 | 间接混凝土编码器 |

#### 超参数设置

| 超参数 | 搜索范围 | 说明 |
|-------|---------|------|
| **候选特征数 k_max** | [10, 50, 100, 200, 500, 1000] | **主要搜索参数1 (量级变化)** |
| **稀疏系数权重 (λ)** | [0.001, 0.01, 0.1, 1, 10, 100] | **主要搜索参数2 (量级变化)** |
| input_dim | 数据集特征数 | 固定 |
| initial_temperature | 10.0 | 固定 |
| final_temperature | 0.01 | 固定 |
| total_epochs | 100 | 固定 |
| gate_embedding_dim | 64 | 固定 |
| encoder_embedding_dim | 64 | 固定 |

#### 实验矩阵

对于每种算法组合，进行 k_max × λ 的网格搜索：

| k_max \ λ | 0.001 | 0.01 | 0.1 | 1 | 10 | 100 |
|----------|-------|------|-----|---|----|-----|
| 10 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 50 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 100 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 200 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 500 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |
| 1000 | ✓ | ✓ | ✓ | ✓ | ✓ | ✓ |

**总计**: 8 × 6 × 6 = 288 组实验

---

### 2.4 对比实验汇总

| 算法类型 | 实验组数 | 主要超参数 |
|---------|---------|-----------|
| 纯门控 | 24 | 稀疏系数权重 λ (6个值，量级变化) |
| 纯编码 | 100 | 特征数 k (1-50完整网格) |
| 门控+编码 | 288 | k_max (6个值) × λ (6个值)，量级变化 |
| **总计** | **412** | - |

---

## 三、消融实验

针对所提算法 **IPCAE + GumbelSoftmaxGate（带门控编码）** 进行深入分析。

### 3.1 所提算法配置

```
算法名称: GumbelSoftmaxGate + IndirectConcreteEncoder
组件:
- 门控: GumbelSoftmaxGate (带门控向量编码)
- 编码器: IndirectConcreteEncoder
```

### 3.2 消融因素

| 编号 | 因素 | 搜索范围 | 固定参数 |
|-----|------|---------|---------|
| **A1** | 候选特征数 k_max | [10, 50, 100, 200, 500, 1000] | λ=0.1, gate_emb=64, enc_emb=64 |
| **A2** | 稀疏系数权重 λ | [0.001, 0.01, 0.1, 1, 10, 100] | k_max=100, gate_emb=64, enc_emb=64 |
| **A3** | 门控编码维度 | [4, 64, 128, 256, 1024] | k_max=100, λ=0.1, enc_emb=64 |
| **A4** | IPCAE编码维度 | [4, 64, 128, 256, 1024] | k_max=100, λ=0.1, gate_emb=64 |

### 3.3 消融实验详细设计

#### A1: 候选特征数 k_max 的影响 (量级变化)

| 实验编号 | k_max | 固定参数 |
|---------|-------|---------|
| A1-1 | 10 | λ=0.1, gate_emb=64, enc_emb=64 |
| A1-2 | 50 | λ=0.1, gate_emb=64, enc_emb=64 |
| A1-3 | 100 | λ=0.1, gate_emb=64, enc_emb=64 |
| A1-4 | 200 | λ=0.1, gate_emb=64, enc_emb=64 |
| A1-5 | 500 | λ=0.1, gate_emb=64, enc_emb=64 |
| A1-6 | 1000 | λ=0.1, gate_emb=64, enc_emb=64 |

**预期分析**: k_max 增大时，任务性能提升但稀疏性下降

---

#### A2: 稀疏系数权重 λ 的影响 (量级变化)

| 实验编号 | λ | 固定参数 |
|---------|---|---------|
| A2-1 | 0.001 | k_max=100, gate_emb=64, enc_emb=64 |
| A2-2 | 0.01 | k_max=100, gate_emb=64, enc_emb=64 |
| A2-3 | 0.1 | k_max=100, gate_emb=64, enc_emb=64 |
| A2-4 | 1 | k_max=100, gate_emb=64, enc_emb=64 |
| A2-5 | 10 | k_max=100, gate_emb=64, enc_emb=64 |
| A2-6 | 100 | k_max=100, gate_emb=64, enc_emb=64 |

**预期分析**: λ 增大时，稀疏性增加但可能损失任务性能

---

#### A3: 门控编码维度的影响 (量级变化)

| 实验编号 | gate_embedding_dim | 固定参数 |
|---------|-------------------|---------|
| A3-1 | 4 | k_max=100, λ=0.1, enc_emb=64 |
| A3-2 | 64 | k_max=100, λ=0.1, enc_emb=64 |
| A3-3 | 128 | k_max=100, λ=0.1, enc_emb=64 |
| A3-4 | 256 | k_max=100, λ=0.1, enc_emb=64 |
| A3-5 | 1024 | k_max=100, λ=0.1, enc_emb=64 |

**预期分析**: 门控编码维度影响参数量和表达能力

---

#### A4: IPCAE编码维度的影响 (量级变化)

| 实验编号 | encoder_embedding_dim | 固定参数 |
|---------|----------------------|---------|
| A4-1 | 4 | k_max=100, λ=0.1, gate_emb=64 |
| A4-2 | 64 | k_max=100, λ=0.1, gate_emb=64 |
| A4-3 | 128 | k_max=100, λ=0.1, gate_emb=64 |
| A4-4 | 256 | k_max=100, λ=0.1, gate_emb=64 |
| A4-5 | 1024 | k_max=100, λ=0.1, gate_emb=64 |

**预期分析**: IPCAE编码维度影响特征选择的参数效率和表达能力

---

### 3.4 消融实验汇总

| 因素 | 实验组数 | 搜索值数量 |
|-----|---------|-----------|
| k_max | 6 | 6个值 (量级变化) |
| λ | 6 | 6个值 (量级变化) |
| gate_embedding_dim | 5 | 5个值 (量级变化) |
| encoder_embedding_dim | 5 | 5个值 (量级变化) |
| **总计** | **22** | - |

---

## 四、实验配置

### 4.1 数据集

| 数据集 | 样本数 | 特征数 | 任务类型 |
|-------|-------|-------|---------|
| (待补充) | - | - | - |

### 4.2 训练配置

| 配置项 | 值 |
|-------|---|
| 训练轮数 | 100 |
| 批量大小 | 32 |
| 学习率 | 1e-3 |
| 优化器 | Adam |
| 随机种子 | [42, 123, 456, 789, 1024] (5次运行) |
| 数据划分 | 训练60% / 验证20% / 测试20% |

### 4.3 结果记录格式

#### 单次实验结果

```json
{
    "experiment_id": "G1-3",
    "algorithm": "StochasticGate",
    "category": "gate_only",
    "hyperparameters": {
        "lambda": 0.1
    },
    "metrics": {
        "task_performance": 0.85,
        "sparsity": 0.23,
        "num_params": 1000,
        "train_time": 120.5
    },
    "seed": 42
}
```

#### 汇总结果

| 算法 | 超参数 | 任务性能 | 稀疏性 | 参数量 | 稳定性 |
|-----|-------|---------|-------|-------|-------|
| ... | ... | mean±std | mean±std | - | std/mean |

---

## 五、实验执行计划

### 5.1 实验顺序

1. **Phase 1**: 纯门控算法对比 (24组 × 5次 = 120次运行)
2. **Phase 2**: 纯编码算法对比 (100组 × 5次 = 500次运行)
3. **Phase 3**: 门控+编码算法对比 (288组 × 5次 = 1440次运行)
4. **Phase 4**: 消融实验 (22组 × 5次 = 110次运行)

**总运行次数**: 2170次

### 5.2 预计时间

假设每次运行需要 5 分钟：
- Phase 1: 120 × 5 = 600 分钟 = 10 小时
- Phase 2: 500 × 5 = 2500 分钟 ≈ 42 小时
- Phase 3: 1440 × 5 = 7200 分钟 ≈ 120 小时
- Phase 4: 110 × 5 = 550 分钟 ≈ 9 小时

**总计**: 约 181 小时 (可并行化)

### 5.3 并行化建议

- 使用多GPU并行运行不同超参数组合
- 建议并行度: 8-16 个实验同时运行
- 预计实际时间: 12-24 小时

### 5.4 结果保存路径

实验结果将保存在 `exp/results/` 目录下，按实验类型组织：

```
exp/results/
├── contrast/                    # 对比实验结果
│   ├── gate_only/              # 纯门控实验
│   │   └── results.csv         # 汇总CSV
│   ├── encoder_only/           # 纯编码实验
│   │   └── results.csv
│   └── gate_encoder/           # 门控+编码实验
│       └── results.csv
└── ablation/                    # 消融实验结果
    ├── k_max/                   # k_max 影响
    │   └── results.csv
    ├── lambda/                  # λ 影响
    │   └── results.csv
    ├── gate_embedding_dim/      # 门控编码维度影响
    │   └── results.csv
    └── encoder_embedding_dim/   # IPCAE编码维度影响
        └── results.csv
```

CSV 文件格式：
```csv
experiment_id,algorithm,category,hyperparameters,task_performance,sparsity,num_params,train_time,seed,stability
G1-1,StochasticGate,gate_only,"{""lambda"": 0.001}",0.85,0.23,1000,120.5,42,0.02
```

---

## 六、预期结果表格模板

### 6.1 纯门控算法结果

| 算法 | λ=0.001 | λ=0.01 | λ=0.1 | λ=1 | λ=10 | λ=100 |
|-----|---------|--------|-------|-----|------|-------|
| **StochasticGate** | | | | | | |
| 任务性能 | - | - | - | - | - | - |
| 稀疏性 | - | - | - | - | - | - |
| **GumbelSigmoidGate** | | | | | | |
| 任务性能 | - | - | - | - | - | - |
| 稀疏性 | - | - | - | - | - | - |
| **GumbelSoftmaxGate** | | | | | | |
| 任务性能 | - | - | - | - | - | - |
| 稀疏性 | - | - | - | - | - | - |
| **HardConcreteGate** | | | | | | |
| 任务性能 | - | - | - | - | - | - |
| 稀疏性 | - | - | - | - | - | - |

### 6.2 纯编码算法结果

| 算法 | k=1 | k=5 | k=10 | k=15 | k=20 | k=25 | k=30 | k=35 | k=40 | k=45 | k=50 |
|-----|-----|-----|------|------|------|------|------|------|------|------|------|
| **ConcreteEncoder** | | | | | | | | | | | |
| 任务性能 | - | - | - | - | - | - | - | - | - | - | - |
| **IndirectConcreteEncoder** | | | | | | | | | | | |
| 任务性能 | - | - | - | - | - | - | - | - | - | - | - |

### 6.3 门控+编码算法结果 (以GE6为例)

| k_max \ λ | 0.001 | 0.01 | 0.1 | 1 | 10 |
|----------|-------|------|-----|---|----|
| **10** | | | | | |
| 任务性能 | - | - | - | - | - |
| 稀疏性 | - | - | - | - | - |
| **20** | | | | | |
| 任务性能 | - | - | - | - | - |
| 稀疏性 | - | - | - | - | - |
| ... | | | | | |

### 6.4 消融实验结果

#### k_max 影响

| k_max | 任务性能 | 稀疏性 | 参数量 | 稳定性 |
|-------|---------|-------|-------|-------|
| 5 | - | - | - | - |
| 10 | - | - | - | - |
| ... | - | - | - | - |
| 50 | - | - | - | - |

#### λ 影响

| λ | 任务性能 | 稀疏性 | 参数量 | 稳定性 |
|---|---------|-------|-------|-------|
| 0.001 | - | - | - | - |
| 0.005 | - | - | - | - |
| ... | - | - | - | - |
| 10 | - | - | - | - |

#### gate_embedding_dim 影响

| gate_emb | 任务性能 | 稀疏性 | 参数量 | 稳定性 |
|----------|---------|-------|-------|-------|
| 4 | - | - | - | - |
| 8 | - | - | - | - |
| ... | - | - | - | - |
| 128 | - | - | - | - |

#### encoder_embedding_dim 影响

| enc_emb | 任务性能 | 稀疏性 | 参数量 | 稳定性 |
|---------|---------|-------|-------|-------|
| 8 | - | - | - | - |
| 16 | - | - | - | - |
| ... | - | - | - | - |
| 256 | - | - | - | - |

---

## 七、待确认事项

在开始实验前，请确认以下事项：

1. **数据集**: 使用哪些数据集进行实验？请提供数据集名称和路径。

2. **任务类型**: 是分类任务还是回归任务？评估指标是什么？

3. **计算资源**: 有多少GPU可用？并行度是多少？

4. **实验范围**: 是否需要调整对比实验或消融实验的超参数搜索范围？

5. **结果保存**: 实验结果保存路径？

---

**请审核此实验计划，确认后我将开始编写实验代码。**